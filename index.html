<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no">

<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">

<title>Pronunciation</title>

<style>
body {
  margin: 0;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #fff;
}

.card {
  text-align: center;
  padding: 24px;
}

.word {
  font-size: 40px;
  margin-bottom: 24px;
}

button {
  font-size: 18px;
  padding: 14px 26px;
  margin: 10px;
  border-radius: 12px;
  border: none;
  background: #3478f6;
  color: white;
}

button:disabled {
  background: #ccc;
}

.status {
  margin-top: 12px;
  color: #666;
  font-size: 14px;
}
</style>
</head>

<body>
<div class="card">
  <div class="word" id="word">word</div>

  <button id="recordBtn">ğŸ¤ å¼€å§‹å½•éŸ³ï¼ˆ3 ç§’ï¼‰</button>
  <br>
  <button id="playBtn" disabled>â–¶ï¸ æ’­æ”¾æˆ‘çš„å½•éŸ³</button>

  <div class="status" id="status">æœªå¼€å§‹</div>
</div>

<script>
const params = new URLSearchParams(location.search);
const word = params.get("word") || "";
document.getElementById("word").innerText = word;

let mediaRecorder;
let chunks = [];
let audioBlob = null;

const recordBtn = document.getElementById("recordBtn");
const playBtn = document.getElementById("playBtn");
const status = document.getElementById("status");

recordBtn.onclick = async () => {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

    mediaRecorder = new MediaRecorder(stream);
    chunks = [];

    mediaRecorder.ondataavailable = e => chunks.push(e.data);

    mediaRecorder.onstop = () => {
      audioBlob = new Blob(chunks, { type: "audio/webm" });
      playBtn.disabled = false;
      status.innerText = "å½•éŸ³å®Œæˆï¼Œå¯ä»¥æ’­æ”¾";
    };

    mediaRecorder.start();
    status.innerText = "å½•éŸ³ä¸­â€¦";

    setTimeout(() => {
      mediaRecorder.stop();
    }, 3000);
  } catch (err) {
    status.innerText = "æ— æ³•è®¿é—®éº¦å…‹é£";
  }
};

playBtn.onclick = () => {
  if (!audioBlob) return;
  const audioUrl = URL.createObjectURL(audioBlob);
  const audio = new Audio(audioUrl);
  audio.play();
};
</script>
</body>
</html>
